/* esm.sh - esbuild bundle(cbor-x@1.5.8) es2022 production */
/** 
 * @title cbor-x
 * @author Kris Zyp
 * @license MIT
 * @source https://github.com/kriszyp/cbor-x
/*
/* 
MIT License

Copyright (c) 2020 Kris Zyp

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
**/
import { Buffer as __Buffer$ } from "../content/buffer.mjs";
var Ue;try{Ue=new TextDecoder}catch{}var y,v,a=0;var ve=[],ut=105,dt=57342,xt=57343,qe=57337;var Ze=6,re={},Me=ve,_e=0,A={},_,ye,pe=0,ae=0,D,W,R=[],Re=[],N,C,oe,Xe={useRecords:!1,mapsAsObjects:!0},ce=!1,et=2;try{new Function("")}catch{et=1/0}var Z=class e{constructor(t){if(t&&((t.keyMap||t._keyMap)&&!t.useRecords&&(t.useRecords=!1,t.mapsAsObjects=!0),t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.getStructures&&(t.getShared=t.getStructures),t.getShared&&!t.structures&&((t.structures=[]).uninitialized=!0),t.keyMap)){this.mapKey=new Map;for(let[s,n]of Object.entries(t.keyMap))this.mapKey.set(n,s)}Object.assign(this,t)}decodeKey(t){return this.keyMap&&this.mapKey.get(t)||t}encodeKey(t){return this.keyMap&&this.keyMap.hasOwnProperty(t)?this.keyMap[t]:t}encodeKeys(t){if(!this._keyMap)return t;let s=new Map;for(let[n,f]of Object.entries(t))s.set(this._keyMap.hasOwnProperty(n)?this._keyMap[n]:n,f);return s}decodeKeys(t){if(!this._keyMap||t.constructor.name!="Map")return t;if(!this._mapKey){this._mapKey=new Map;for(let[n,f]of Object.entries(this._keyMap))this._mapKey.set(f,n)}let s={};return t.forEach((n,f)=>s[j(this._mapKey.has(f)?this._mapKey.get(f):f)]=n),s}mapDecode(t,s){let n=this.decode(t);if(this._keyMap)switch(n.constructor.name){case"Array":return n.map(f=>this.decodeKeys(f))}return n}decode(t,s){if(y)return nt(()=>(ge(),this?this.decode(t,s):e.prototype.decode.call(Xe,t,s)));v=s>-1?s:t.length,a=0,_e=0,ae=0,ye=null,Me=ve,D=null,y=t;try{C=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(n){throw y=null,t instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof e){if(A=this,N=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return _=this.structures,he();(!_||_.length>0)&&(_=[])}else A=Xe,(!_||_.length>0)&&(_=[]),N=null;return he()}decodeMultiple(t,s){let n,f=0;try{let o=t.length;ce=!0;let u=this?this.decode(t,o):Ce.decode(t,o);if(s){if(s(u)===!1)return;for(;a<o;)if(f=a,s(he())===!1)return}else{for(n=[u];a<o;)f=a,n.push(he());return n}}catch(o){throw o.lastPosition=f,o.values=n,o}finally{ce=!1,ge()}}};function he(){try{let e=E();if(D){if(a>=D.postBundlePosition){let t=new Error("Unexpected bundle position");throw t.incomplete=!0,t}a=D.postBundlePosition,D=null}if(a==v)_=null,y=null,W&&(W=null);else if(a>v){let t=new Error("Unexpected end of CBOR data");throw t.incomplete=!0,t}else if(!ce)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw ge(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function E(){let e=y[a++],t=e>>5;if(e=e&31,e>23)switch(e){case 24:e=y[a++];break;case 25:if(t==7)return wt();e=C.getUint16(a),a+=2;break;case 26:if(t==7){let s=C.getFloat32(a);if(A.useFloat32>2){let n=ue[(y[a]&127)<<1|y[a+1]>>7];return a+=4,(n*s+(s>0?.5:-.5)>>0)/n}return a+=4,s}e=C.getUint32(a),a+=4;break;case 27:if(t==7){let s=C.getFloat64(a);return a+=8,s}if(t>1){if(C.getUint32(a)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=C.getUint32(a+4)}else A.int64AsNumber?(e=C.getUint32(a)*4294967296,e+=C.getUint32(a+4)):e=C.getBigUint64(a);a+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let s=[],n,f=0;for(;(n=E())!=re;)s[f++]=n;return t==4?s:t==3?s.join(""):__Buffer$.concat(s);case 5:let o;if(A.mapsAsObjects){let u={};if(A.keyMap)for(;(o=E())!=re;)u[j(A.decodeKey(o))]=E();else for(;(o=E())!=re;)u[j(o)]=E();return u}else{oe&&(A.mapsAsObjects=!0,oe=!1);let u=new Map;if(A.keyMap)for(;(o=E())!=re;)u.set(A.decodeKey(o),E());else for(;(o=E())!=re;)u.set(o,E());return u}case 7:return re;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:return gt(e);case 3:if(ae>=a)return ye.slice(a-pe,(a+=e)-pe);if(ae==0&&v<140&&e<32){let f=e<16?tt(e):pt(e);if(f!=null)return f}return ht(e);case 4:let s=new Array(e);for(let f=0;f<e;f++)s[f]=E();return s;case 5:if(A.mapsAsObjects){let f={};if(A.keyMap)for(let o=0;o<e;o++)f[j(A.decodeKey(E()))]=E();else for(let o=0;o<e;o++)f[j(E())]=E();return f}else{oe&&(A.mapsAsObjects=!0,oe=!1);let f=new Map;if(A.keyMap)for(let o=0;o<e;o++)f.set(A.decodeKey(E()),E());else for(let o=0;o<e;o++)f.set(E(),E());return f}case 6:if(e>=qe){let f=_[e&8191];if(f)return f.read||(f.read=Be(f)),f.read();if(e<65536){if(e==xt){let o=se(),u=E(),w=E();Te(u,w);let U={};if(A.keyMap)for(let p=2;p<o;p++){let B=A.decodeKey(w[p-2]);U[j(B)]=E()}else for(let p=2;p<o;p++){let B=w[p-2];U[j(B)]=E()}return U}else if(e==dt){let o=se(),u=E();for(let w=2;w<o;w++)Te(u++,E());return E()}else if(e==qe)return It();if(A.getShared&&(Ve(),f=_[e&8191],f))return f.read||(f.read=Be(f)),f.read()}}let n=R[e];if(n)return n.handlesRead?n(E):n(E());{let f=E();for(let o=0;o<Re.length;o++){let u=Re[o](e,f);if(u!==void 0)return u}return new J(f,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let f=(N||Q())[e];if(f!==void 0)return f;throw new Error("Unknown token "+e)}default:if(isNaN(e)){let f=new Error("Unexpected end of CBOR data");throw f.incomplete=!0,f}throw new Error("Unknown CBOR token "+e)}}var $e=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Be(e){function t(){let s=y[a++];if(s=s&31,s>23)switch(s){case 24:s=y[a++];break;case 25:s=C.getUint16(a),a+=2;break;case 26:s=C.getUint32(a),a+=4;break;default:throw new Error("Expected array header, but got "+y[a-1])}let n=this.compiledReader;for(;n;){if(n.propertyCount===s)return n(E);n=n.next}if(this.slowReads++>=et){let o=this.length==s?this:this.slice(0,s);return n=A.keyMap?new Function("r","return {"+o.map(u=>A.decodeKey(u)).map(u=>$e.test(u)?j(u)+":r()":"["+JSON.stringify(u)+"]:r()").join(",")+"}"):new Function("r","return {"+o.map(u=>$e.test(u)?j(u)+":r()":"["+JSON.stringify(u)+"]:r()").join(",")+"}"),this.compiledReader&&(n.next=this.compiledReader),n.propertyCount=s,this.compiledReader=n,n(E)}let f={};if(A.keyMap)for(let o=0;o<s;o++)f[j(A.decodeKey(this[o]))]=E();else for(let o=0;o<s;o++)f[j(this[o])]=E();return f}return e.slowReads=0,t}function j(e){if(typeof e=="string")return e==="__proto__"?"__proto_":e;if(typeof e!="object")return e.toString();throw new Error("Invalid property name type "+typeof e)}var ht=De;var yt=!1;function De(e){let t;if(e<16&&(t=tt(e)))return t;if(e>64&&Ue)return Ue.decode(y.subarray(a,a+=e));let s=a+e,n=[];for(t="";a<s;){let f=y[a++];if(!(f&128))n.push(f);else if((f&224)===192){let o=y[a++]&63;n.push((f&31)<<6|o)}else if((f&240)===224){let o=y[a++]&63,u=y[a++]&63;n.push((f&31)<<12|o<<6|u)}else if((f&248)===240){let o=y[a++]&63,u=y[a++]&63,w=y[a++]&63,U=(f&7)<<18|o<<12|u<<6|w;U>65535&&(U-=65536,n.push(U>>>10&1023|55296),U=56320|U&1023),n.push(U)}else n.push(f);n.length>=4096&&(t+=F.apply(String,n),n.length=0)}return n.length>0&&(t+=F.apply(String,n)),t}var F=String.fromCharCode;function pt(e){let t=a,s=new Array(e);for(let n=0;n<e;n++){let f=y[a++];if((f&128)>0){a=t;return}s[n]=f}return F.apply(String,s)}function tt(e){if(e<4)if(e<2){if(e===0)return"";{let t=y[a++];if((t&128)>1){a-=1;return}return F(t)}}else{let t=y[a++],s=y[a++];if((t&128)>0||(s&128)>0){a-=2;return}if(e<3)return F(t,s);let n=y[a++];if((n&128)>0){a-=3;return}return F(t,s,n)}else{let t=y[a++],s=y[a++],n=y[a++],f=y[a++];if((t&128)>0||(s&128)>0||(n&128)>0||(f&128)>0){a-=4;return}if(e<6){if(e===4)return F(t,s,n,f);{let o=y[a++];if((o&128)>0){a-=5;return}return F(t,s,n,f,o)}}else if(e<8){let o=y[a++],u=y[a++];if((o&128)>0||(u&128)>0){a-=6;return}if(e<7)return F(t,s,n,f,o,u);let w=y[a++];if((w&128)>0){a-=7;return}return F(t,s,n,f,o,u,w)}else{let o=y[a++],u=y[a++],w=y[a++],U=y[a++];if((o&128)>0||(u&128)>0||(w&128)>0||(U&128)>0){a-=8;return}if(e<10){if(e===8)return F(t,s,n,f,o,u,w,U);{let p=y[a++];if((p&128)>0){a-=9;return}return F(t,s,n,f,o,u,w,U,p)}}else if(e<12){let p=y[a++],B=y[a++];if((p&128)>0||(B&128)>0){a-=10;return}if(e<11)return F(t,s,n,f,o,u,w,U,p,B);let k=y[a++];if((k&128)>0){a-=11;return}return F(t,s,n,f,o,u,w,U,p,B,k)}else{let p=y[a++],B=y[a++],k=y[a++],L=y[a++];if((p&128)>0||(B&128)>0||(k&128)>0||(L&128)>0){a-=12;return}if(e<14){if(e===12)return F(t,s,n,f,o,u,w,U,p,B,k,L);{let V=y[a++];if((V&128)>0){a-=13;return}return F(t,s,n,f,o,u,w,U,p,B,k,L,V)}}else{let V=y[a++],K=y[a++];if((V&128)>0||(K&128)>0){a-=14;return}if(e<15)return F(t,s,n,f,o,u,w,U,p,B,k,L,V,K);let G=y[a++];if((G&128)>0){a-=15;return}return F(t,s,n,f,o,u,w,U,p,B,k,L,V,K,G)}}}}}function gt(e){return A.copyBuffers?Uint8Array.prototype.slice.call(y,a,a+=e):y.subarray(a,a+=e)}var Fe=new Float32Array(1),ie=new Uint8Array(Fe.buffer,0,4);function wt(){let e=y[a++],t=y[a++],s=(e&127)>>2;if(s===31)return t||e&3?NaN:e&128?-1/0:1/0;if(s===0){let n=((e&3)<<8|t)/16777216;return e&128?-n:n}return ie[3]=e&128|(s>>1)+56,ie[2]=(e&7)<<5|t>>3,ie[1]=t<<5,ie[0]=0,Fe[0]}var Ht=new Array(4096);var J=class{constructor(t,s){this.value=t,this.tag=s}};R[0]=e=>new Date(e);R[1]=e=>new Date(Math.round(e*1e3));R[2]=e=>{let t=BigInt(0);for(let s=0,n=e.byteLength;s<n;s++)t=BigInt(e[s])+t<<BigInt(8);return t};R[3]=e=>BigInt(-1)-R[2](e);R[4]=e=>+(e[1]+"e"+e[0]);R[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));var Te=(e,t)=>{e=e-57344;let s=_[e];s&&s.isShared&&((_.restoreStructures||(_.restoreStructures=[]))[e]=s),_[e]=t,t.read=Be(t)};R[ut]=e=>{let t=e.length,s=e[1];Te(e[0],s);let n={};for(let f=2;f<t;f++){let o=s[f-2];n[j(o)]=e[f]}return n};R[14]=e=>D?D[0].slice(D.position0,D.position0+=e):new J(e,14);R[15]=e=>D?D[1].slice(D.position1,D.position1+=e):new J(e,15);var bt={Error,RegExp};R[27]=e=>(bt[e[0]]||Error)(e[1],e[2]);var rt=e=>{if(y[a++]!=132){let s=new Error("Packed values structure must be followed by a 4 element array");throw y.length<a&&(s.incomplete=!0),s}let t=e();if(!t||!t.length){let s=new Error("Packed values structure must be followed by a 4 element array");throw s.incomplete=!0,s}return N=N?t.concat(N.slice(t.length)):t,N.prefixes=e(),N.suffixes=e(),e()};rt.handlesRead=!0;R[51]=rt;R[Ze]=e=>{if(!N)if(A.getShared)Ve();else return new J(e,Ze);if(typeof e=="number")return N[16+(e>=0?2*e:-2*e-1)];let t=new Error("No support for non-integer packed references yet");throw e===void 0&&(t.incomplete=!0),t};R[28]=e=>{W||(W=new Map,W.id=0);let t=W.id++,s=y[a],n;s>>5==4?n=[]:n={};let f={target:n};W.set(t,f);let o=e();return f.used?Object.assign(n,o):(f.target=o,o)};R[28].handlesRead=!0;R[29]=e=>{let t=W.get(e);return t.used=!0,t.target};R[258]=e=>new Set(e);(R[259]=e=>(A.mapsAsObjects&&(A.mapsAsObjects=!1,oe=!0),e())).handlesRead=!0;function ne(e,t){return typeof e=="string"?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function Q(){if(!N)if(A.getShared)Ve();else throw new Error("No packed values available");return N}var mt=1399353956;Re.push((e,t)=>{if(e>=225&&e<=255)return ne(Q().prefixes[e-224],t);if(e>=28704&&e<=32767)return ne(Q().prefixes[e-28672],t);if(e>=1879052288&&e<=2147483647)return ne(Q().prefixes[e-1879048192],t);if(e>=216&&e<=223)return ne(t,Q().suffixes[e-216]);if(e>=27647&&e<=28671)return ne(t,Q().suffixes[e-27639]);if(e>=1811940352&&e<=1879048191)return ne(t,Q().suffixes[e-1811939328]);if(e==mt)return{packedValues:N,structures:_.slice(0),version:t};if(e==55799)return t});var St=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,Qe=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],At=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<Qe.length;e++)Et(Qe[e],At[e]);function Et(e,t){let s="get"+e.name.slice(0,-5),n;typeof e=="function"?n=e.BYTES_PER_ELEMENT:e=null;for(let f=0;f<2;f++){if(!f&&n==1)continue;let o=n==2?1:n==4?2:3;R[f?t:t-4]=n==1||f==St?u=>{if(!e)throw new Error("Could not find typed array for code "+t);return!A.copyBuffers&&(n===1||n===2&&!(u.byteOffset&1)||n===4&&!(u.byteOffset&3)||n===8&&!(u.byteOffset&7))?new e(u.buffer,u.byteOffset,u.byteLength):new e(Uint8Array.prototype.slice.call(u,0).buffer)}:u=>{if(!e)throw new Error("Could not find typed array for code "+t);let w=new DataView(u.buffer,u.byteOffset,u.byteLength),U=u.length>>o,p=new e(U),B=w[s];for(let k=0;k<U;k++)p[k]=B.call(w,k<<o,f);return p}}}function It(){let e=se(),t=a+E();for(let n=2;n<e;n++){let f=se();a+=f}let s=a;return a=t,D=[De(se()),De(se())],D.position0=0,D.position1=0,D.postBundlePosition=a,a=s,E()}function se(){let e=y[a++]&31;if(e>23)switch(e){case 24:e=y[a++];break;case 25:e=C.getUint16(a),a+=2;break;case 26:e=C.getUint32(a),a+=4;break}return e}function Ve(){if(A.getShared){let e=nt(()=>(y=null,A.getShared()))||{},t=e.structures||[];A.sharedVersion=e.version,N=A.sharedValues=e.packedValues,_===!0?A.structures=_=t:_.splice.apply(_,[0,t.length].concat(t))}}function nt(e){let t=v,s=a,n=_e,f=pe,o=ae,u=ye,w=Me,U=W,p=D,B=new Uint8Array(y.slice(0,v)),k=_,L=A,V=ce,K=e();return v=t,a=s,_e=n,pe=f,ae=o,ye=u,Me=w,W=U,D=p,y=B,ce=V,_=k,A=L,C=new DataView(y.buffer,y.byteOffset,y.byteLength),K}function ge(){y=null,W=null,_=null}function it(e){R[e.tag]=e.decode}var ue=new Array(147);for(let e=0;e<256;e++)ue[e]=+("1e"+Math.floor(45.15-e*.30103));var Ce=new Z({useRecords:!1}),Ot=Ce.decode,kt=Ce.decodeMultiple,we={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4};function Ut(e){Fe[0]=e;let t=ue[(ie[3]&127)<<1|ie[2]>>7];return(t*e+(e>0?.5:-.5)>>0)/t}var be;try{be=new TextEncoder}catch{}var Se,ze,Ee=typeof globalThis=="object"&&globalThis.Buffer,de=typeof Ee<"u",Ne=de?Ee.allocUnsafeSlow:Uint8Array,st=de?Ee:Uint8Array,lt=256,ft=de?4294967296:2144337920;var Pe,i,M,r=0,X,T=null,Mt=61440,_t=/[\u0080-\uFFFF]/,P=Symbol("record-id"),ee=class extends Z{constructor(t){super(t),this.offset=0;let s,n,f,o,u,w;t=t||{};let U=st.prototype.utf8Write?function(l,h,d){return i.utf8Write(l,h,d)}:be&&be.encodeInto?function(l,h){return be.encodeInto(l,i.subarray(h)).written}:!1,p=this,B=t.structures||t.saveStructures,k=t.maxSharedStructures;if(k==null&&(k=B?128:0),k>8190)throw new Error("Maximum maxSharedStructure is 8190");let L=t.sequential;L&&(k=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let V,K,G=t.sharedValues,z;if(G){z=Object.create(null);for(let l=0,h=G.length;l<h;l++)z[G[l]]=l}let q=[],Ie=0,xe=0;this.mapEncode=function(l,h){if(this._keyMap&&!this._mapped)switch(l.constructor.name){case"Array":l=l.map(d=>this.encodeKeys(d));break}return this.encode(l,h)},this.encode=function(l,h){if(i||(i=new Ne(8192),M=new DataView(i.buffer,0,8192),r=0),X=i.length-10,X-r<2048?(i=new Ne(i.length),M=new DataView(i.buffer,0,i.length),X=i.length-10,r=0):h===Ke&&(r=r+7&2147483640),n=r,p.useSelfDescribedHeader&&(M.setUint32(r,3654940416),r+=3),w=p.structuredClone?new Map:null,p.bundleStrings&&typeof l!="string"?(T=[],T.size=1/0):T=null,f=p.structures,f){if(f.uninitialized){let x=p.getShared()||{};p.structures=f=x.structures||[],p.sharedVersion=x.version;let c=p.sharedValues=x.packedValues;if(c){z={};for(let g=0,b=c.length;g<b;g++)z[c[g]]=g}}let d=f.length;if(d>k&&!L&&(d=k),!f.transitions){f.transitions=Object.create(null);for(let x=0;x<d;x++){let c=f[x];if(!c)continue;let g,b=f.transitions;for(let m=0,S=c.length;m<S;m++){b[P]===void 0&&(b[P]=x);let I=c[m];g=b[I],g||(g=b[I]=Object.create(null)),b=g}b[P]=x|1048576}}L||(f.nextId=d)}if(o&&(o=!1),u=f||[],K=z,t.pack){let d=new Map;if(d.values=[],d.encoder=p,d.maxValues=t.maxPrivatePackedValues||(z?16:1/0),d.objectMap=z||!1,d.samplingPackedValues=V,me(l,d),d.values.length>0){i[r++]=216,i[r++]=51,H(4);let x=d.values;O(x),H(0),H(0),K=Object.create(z||null);for(let c=0,g=x.length;c<g;c++)K[x[c]]=c}}Pe=h&je;try{if(Pe)return;if(O(l),T&&ct(n,O),p.offset=r,w&&w.idsToInsert){r+=w.idsToInsert.length*2,r>X&&le(r),p.offset=r;let d=Dt(i.subarray(n,r),w.idsToInsert);return w=null,d}return h&Ke?(i.start=n,i.end=r,i):i.subarray(n,r)}finally{if(f){if(xe<10&&xe++,f.length>k&&(f.length=k),Ie>1e4)f.transitions=null,xe=0,Ie=0,q.length>0&&(q=[]);else if(q.length>0&&!L){for(let d=0,x=q.length;d<x;d++)q[d][P]=void 0;q=[]}}if(o&&p.saveShared){p.structures.length>k&&(p.structures=p.structures.slice(0,k));let d=i.subarray(n,r);return p.updateSharedData()===!1?p.encode(l):d}h&Kt&&(r=n)}},this.findCommonStringsToPack=()=>(V=new Map,z||(z=Object.create(null)),l=>{let h=l&&l.threshold||4,d=this.pack?l.maxPrivatePackedValues||16:0;G||(G=this.sharedValues=[]);for(let[x,c]of V)c.count>h&&(z[x]=d++,G.push(x),o=!0);for(;this.saveShared&&this.updateSharedData()===!1;);V=null});let O=l=>{r>X&&(i=le(r));var h=typeof l,d;if(h==="string"){if(K){let b=K[l];if(b>=0){b<16?i[r++]=b+224:(i[r++]=198,b&1?O(15-b>>1):O(b-16>>1));return}else if(V&&!t.pack){let m=V.get(l);m?m.count++:V.set(l,{count:1})}}let x=l.length;if(T&&x>=4&&x<1024){if((T.size+=x)>Mt){let m,S=(T[0]?T[0].length*3+T[1].length:0)+10;r+S>X&&(i=le(r+S)),i[r++]=217,i[r++]=223,i[r++]=249,i[r++]=T.position?132:130,i[r++]=26,m=r-n,r+=4,T.position&&ct(n,O),T=["",""],T.size=0,T.position=m}let b=_t.test(l);T[b?0:1]+=l,i[r++]=b?206:207,O(x);return}let c;x<32?c=1:x<256?c=2:x<65536?c=3:c=5;let g=x*3;if(r+g>X&&(i=le(r+g)),x<64||!U){let b,m,S,I=r+c;for(b=0;b<x;b++)m=l.charCodeAt(b),m<128?i[I++]=m:m<2048?(i[I++]=m>>6|192,i[I++]=m&63|128):(m&64512)===55296&&((S=l.charCodeAt(b+1))&64512)===56320?(m=65536+((m&1023)<<10)+(S&1023),b++,i[I++]=m>>18|240,i[I++]=m>>12&63|128,i[I++]=m>>6&63|128,i[I++]=m&63|128):(i[I++]=m>>12|224,i[I++]=m>>6&63|128,i[I++]=m&63|128);d=I-r-c}else d=U(l,r+c,g);d<24?i[r++]=96|d:d<256?(c<2&&i.copyWithin(r+2,r+1,r+1+d),i[r++]=120,i[r++]=d):d<65536?(c<3&&i.copyWithin(r+3,r+2,r+2+d),i[r++]=121,i[r++]=d>>8,i[r++]=d&255):(c<5&&i.copyWithin(r+5,r+3,r+3+d),i[r++]=122,M.setUint32(r,d),r+=4),r+=d}else if(h==="number")if(!this.alwaysUseFloat&&l>>>0===l)l<24?i[r++]=l:l<256?(i[r++]=24,i[r++]=l):l<65536?(i[r++]=25,i[r++]=l>>8,i[r++]=l&255):(i[r++]=26,M.setUint32(r,l),r+=4);else if(!this.alwaysUseFloat&&l>>0===l)l>=-24?i[r++]=31-l:l>=-256?(i[r++]=56,i[r++]=~l):l>=-65536?(i[r++]=57,M.setUint16(r,~l),r+=2):(i[r++]=58,M.setUint32(r,~l),r+=4);else{let x;if((x=this.useFloat32)>0&&l<4294967296&&l>=-2147483648){i[r++]=250,M.setFloat32(r,l);let c;if(x<4||(c=l*ue[(i[r]&127)<<1|i[r+1]>>7])>>0===c){r+=4;return}else r--}i[r++]=251,M.setFloat64(r,l),r+=8}else if(h==="object")if(!l)i[r++]=246;else{if(w){let c=w.get(l);if(c){if(i[r++]=216,i[r++]=29,i[r++]=25,!c.references){let g=w.idsToInsert||(w.idsToInsert=[]);c.references=[],g.push(c)}c.references.push(r-n),r+=2;return}else w.set(l,{offset:r-n})}let x=l.constructor;if(x===Object)Oe(l,!0);else if(x===Array){d=l.length,d<24?i[r++]=128|d:H(d);for(let c=0;c<d;c++)O(l[c])}else if(x===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(i[r++]=217,i[r++]=1,i[r++]=3),d=l.size,d<24?i[r++]=160|d:d<256?(i[r++]=184,i[r++]=d):d<65536?(i[r++]=185,i[r++]=d>>8,i[r++]=d&255):(i[r++]=186,M.setUint32(r,d),r+=4),p.keyMap)for(let[c,g]of l)O(p.encodeKey(c)),O(g);else for(let[c,g]of l)O(c),O(g);else{for(let c=0,g=Se.length;c<g;c++){let b=ze[c];if(l instanceof b){let m=Se[c],S=m.tag;S==null&&(S=m.getTag&&m.getTag.call(this,l)),S<24?i[r++]=192|S:S<256?(i[r++]=216,i[r++]=S):S<65536?(i[r++]=217,i[r++]=S>>8,i[r++]=S&255):S>-1&&(i[r++]=218,M.setUint32(r,S),r+=4),m.encode.call(this,l,O,le);return}}if(l[Symbol.iterator]){if(Pe){let c=new Error("Iterable should be serialized as iterator");throw c.iteratorNotHandled=!0,c}i[r++]=159;for(let c of l)O(c);i[r++]=255;return}if(l[Symbol.asyncIterator]||Le(l)){let c=new Error("Iterable/blob should be serialized as iterator");throw c.iteratorNotHandled=!0,c}if(this.useToJSON&&l.toJSON){let c=l.toJSON();if(c!==l)return O(c)}Oe(l,!l.hasOwnProperty)}}else if(h==="boolean")i[r++]=l?245:244;else if(h==="bigint"){if(l<BigInt(1)<<BigInt(64)&&l>=0)i[r++]=27,M.setBigUint64(r,l);else if(l>-(BigInt(1)<<BigInt(64))&&l<0)i[r++]=59,M.setBigUint64(r,-l-BigInt(1));else if(this.largeBigIntToFloat)i[r++]=251,M.setFloat64(r,Number(l));else throw new RangeError(l+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");r+=8}else if(h==="undefined")i[r++]=247;else throw new Error("Unknown type: "+h)},Oe=this.useRecords===!1?this.variableMapSize?l=>{let h=Object.keys(l),d=Object.values(l),x=h.length;x<24?i[r++]=160|x:x<256?(i[r++]=184,i[r++]=x):x<65536?(i[r++]=185,i[r++]=x>>8,i[r++]=x&255):(i[r++]=186,M.setUint32(r,x),r+=4);let c;if(p.keyMap)for(let g=0;g<x;g++)O(p.encodeKey(h[g])),O(d[g]);else for(let g=0;g<x;g++)O(h[g]),O(d[g])}:(l,h)=>{i[r++]=185;let d=r-n;r+=2;let x=0;if(p.keyMap)for(let c in l)(h||l.hasOwnProperty(c))&&(O(p.encodeKey(c)),O(l[c]),x++);else for(let c in l)(h||l.hasOwnProperty(c))&&(O(c),O(l[c]),x++);i[d+++n]=x>>8,i[d+n]=x&255}:(l,h)=>{let d,x=u.transitions||(u.transitions=Object.create(null)),c=0,g=0,b,m;if(this.keyMap){m=Object.keys(l).map(I=>this.encodeKey(I)),g=m.length;for(let I=0;I<g;I++){let Ge=m[I];d=x[Ge],d||(d=x[Ge]=Object.create(null),c++),x=d}}else for(let I in l)(h||l.hasOwnProperty(I))&&(d=x[I],d||(x[P]&1048576&&(b=x[P]&65535),d=x[I]=Object.create(null),c++),x=d,g++);let S=x[P];if(S!==void 0)S&=65535,i[r++]=217,i[r++]=S>>8|224,i[r++]=S&255;else if(m||(m=x.__keys__||(x.__keys__=Object.keys(l))),b===void 0?(S=u.nextId++,S||(S=0,u.nextId=1),S>=lt&&(u.nextId=(S=k)+1)):S=b,u[S]=m,S<k){i[r++]=217,i[r++]=S>>8|224,i[r++]=S&255,x=u.transitions;for(let I=0;I<g;I++)(x[P]===void 0||x[P]&1048576)&&(x[P]=S),x=x[m[I]];x[P]=S|1048576,o=!0}else{if(x[P]=S,M.setUint32(r,3655335680),r+=3,c&&(Ie+=xe*c),q.length>=lt-k&&(q.shift()[P]=void 0),q.push(x),H(g+2),O(57344+S),O(m),h===null)return;for(let I in l)(h||l.hasOwnProperty(I))&&O(l[I]);return}if(g<24?i[r++]=128|g:H(g),h!==null)for(let I in l)(h||l.hasOwnProperty(I))&&O(l[I])},le=l=>{let h;if(l>16777216){if(l-n>ft)throw new Error("Encoded buffer would be larger than maximum buffer size");h=Math.min(ft,Math.round(Math.max((l-n)*(l>67108864?1.25:2),4194304)/4096)*4096)}else h=(Math.max(l-n<<2,i.length-1)>>12)+1<<12;let d=new Ne(h);return M=new DataView(d.buffer,0,h),i.copy?i.copy(d,0,n,l):d.set(i.slice(n,l)),r-=n,n=0,X=d.length-10,i=d},$=100,Je=1e3;this.encodeAsIterable=function(l,h){return Ye(l,h,te)},this.encodeAsAsyncIterable=function(l,h){return Ye(l,h,He)};function*te(l,h,d){let x=l.constructor;if(x===Object){let c=p.useRecords!==!1;c?Oe(l,null):ot(Object.keys(l).length,160);for(let g in l){let b=l[g];c||O(g),b&&typeof b=="object"?h[g]?yield*te(b,h[g]):yield*ke(b,h,g):O(b)}}else if(x===Array){let c=l.length;H(c);for(let g=0;g<c;g++){let b=l[g];b&&(typeof b=="object"||r-n>$)?h.element?yield*te(b,h.element):yield*ke(b,h,"element"):O(b)}}else if(l[Symbol.iterator]){i[r++]=159;for(let c of l)c&&(typeof c=="object"||r-n>$)?h.element?yield*te(c,h.element):yield*ke(c,h,"element"):O(c);i[r++]=255}else Le(l)?(ot(l.size,64),yield i.subarray(n,r),yield l,fe()):l[Symbol.asyncIterator]?(i[r++]=159,yield i.subarray(n,r),yield l,fe(),i[r++]=255):O(l);d&&r>n?yield i.subarray(n,r):r-n>$&&(yield i.subarray(n,r),fe())}function*ke(l,h,d){let x=r-n;try{O(l),r-n>$&&(yield i.subarray(n,r),fe())}catch(c){if(c.iteratorNotHandled)h[d]={},r=n+x,yield*te.call(this,l,h[d]);else throw c}}function fe(){$=Je,p.encode(null,je)}function Ye(l,h,d){return h&&h.chunkThreshold?$=Je=h.chunkThreshold:$=100,l&&typeof l=="object"?(p.encode(null,je),d(l,p.iterateProperties||(p.iterateProperties={}),!0)):[p.encode(l)]}async function*He(l,h){for(let d of te(l,h,!0)){let x=d.constructor;if(x===st||x===Uint8Array)yield d;else if(Le(d)){let c=d.stream().getReader(),g;for(;!(g=await c.read()).done;)yield g.value}else if(d[Symbol.asyncIterator])for await(let c of d)fe(),c?yield*He(c,h.async||(h.async={})):yield p.encode(c);else yield d}}}useBuffer(t){i=t,M=new DataView(i.buffer,i.byteOffset,i.byteLength),r=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let t=this.sharedVersion||0;this.sharedVersion=t+1;let s=this.structures.slice(0),n=new Ae(s,this.sharedValues,this.sharedVersion),f=this.saveShared(n,o=>(o&&o.version||0)==t);return f===!1?(n=this.getShared()||{},this.structures=n.structures||[],this.sharedValues=n.packedValues,this.sharedVersion=n.version,this.structures.nextId=this.structures.length):s.forEach((o,u)=>this.structures[u]=o),f}};function ot(e,t){e<24?i[r++]=t|e:e<256?(i[r++]=t|24,i[r++]=e):e<65536?(i[r++]=t|25,i[r++]=e>>8,i[r++]=e&255):(i[r++]=t|26,M.setUint32(r,e),r+=4)}var Ae=class{constructor(t,s,n){this.structures=t,this.packedValues=s,this.version=n}};function H(e){e<24?i[r++]=128|e:e<256?(i[r++]=152,i[r++]=e):e<65536?(i[r++]=153,i[r++]=e>>8,i[r++]=e&255):(i[r++]=154,M.setUint32(r,e),r+=4)}var Rt=typeof Blob>"u"?function(){}:Blob;function Le(e){if(e instanceof Rt)return!0;let t=e[Symbol.toStringTag];return t==="Blob"||t==="File"}function me(e,t){switch(typeof e){case"string":if(e.length>3){if(t.objectMap[e]>-1||t.values.length>=t.maxValues)return;let n=t.get(e);if(n)++n.count==2&&t.values.push(e);else if(t.set(e,{count:1}),t.samplingPackedValues){let f=t.samplingPackedValues.get(e);f?f.count++:t.samplingPackedValues.set(e,{count:1})}}break;case"object":if(e)if(e instanceof Array)for(let n=0,f=e.length;n<f;n++)me(e[n],t);else{let n=!t.encoder.useRecords;for(var s in e)e.hasOwnProperty(s)&&(n&&me(s,t),me(e[s],t))}break;case"function":console.log(e)}}var Bt=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;ze=[Date,Set,Error,RegExp,J,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Ae];Se=[{tag:1,encode(e,t){let s=e.getTime()/1e3;(this.useTimestamp32||e.getMilliseconds()===0)&&s>=0&&s<4294967296?(i[r++]=26,M.setUint32(r,s),r+=4):(i[r++]=251,M.setFloat64(r,s),r+=8)}},{tag:258,encode(e,t){let s=Array.from(e);t(s)}},{tag:27,encode(e,t){t([e.name,e.message])}},{tag:27,encode(e,t){t(["RegExp",e.source,e.flags])}},{getTag(e){return e.tag},encode(e,t){t(e.value)}},{encode(e,t,s){at(e,s)}},{getTag(e){if(e.constructor===Uint8Array&&(this.tagUint8Array||de&&this.tagUint8Array!==!1))return 64},encode(e,t,s){at(e,s)}},Y(68,1),Y(69,2),Y(70,4),Y(71,8),Y(72,1),Y(77,2),Y(78,4),Y(79,8),Y(85,4),Y(86,8),{encode(e,t){let s=e.packedValues||[],n=e.structures||[];if(s.values.length>0){i[r++]=216,i[r++]=51,H(4);let f=s.values;t(f),H(0),H(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let o=0,u=f.length;o<u;o++)packedObjectMap[f[o]]=o}if(n){M.setUint32(r,3655335424),r+=3;let f=n.slice(0);f.unshift(57344),f.push(new J(e.version,1399353956)),t(f)}else t(new J(e.version,1399353956))}}];function Y(e,t){return!Bt&&t>1&&(e-=4),{tag:e,encode:function(n,f){let o=n.byteLength,u=n.byteOffset||0,w=n.buffer||n;f(de?Ee.from(w,u,o):new Uint8Array(w,u,o))}}}function at(e,t){let s=e.byteLength;s<24?i[r++]=64+s:s<256?(i[r++]=88,i[r++]=s):s<65536?(i[r++]=89,i[r++]=s>>8,i[r++]=s&255):(i[r++]=90,M.setUint32(r,s),r+=4),r+s>=i.length&&t(r+s),i.set(e.buffer?e:new Uint8Array(e),r),r+=s}function Dt(e,t){let s,n=t.length*2,f=e.length-n;t.sort((o,u)=>o.offset>u.offset?1:-1);for(let o=0;o<t.length;o++){let u=t[o];u.id=o;for(let w of u.references)e[w++]=o>>8,e[w]=o&255}for(;s=t.pop();){let o=s.offset;e.copyWithin(o+n,o,f),n-=2;let u=o+n;e[u++]=216,e[u++]=28,f=o}return e}function ct(e,t){M.setUint32(T.position+e,r-T.position-e+1);let s=T;T=null,t(s[0]),t(s[1])}function Tt(e){if(e.Class){if(!e.encode)throw new Error("Extension has no encode function");ze.unshift(e.Class),Se.unshift(e)}it(e)}var We=new ee({useRecords:!1}),Ft=We.encode,Vt=We.encodeAsIterable,Ct=We.encodeAsAsyncIterable,{NEVER:Nt,ALWAYS:Pt,DECIMAL_ROUND:Lt,DECIMAL_FIT:jt}=we,Ke=512,Kt=1024,je=2048;function zt(e,t={}){if(!e||typeof e!="object")throw new Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable");if(typeof e[Symbol.iterator]=="function")return Wt(e,t);if(typeof e.then=="function"||typeof e[Symbol.asyncIterator]=="function")return Jt(e,t);throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}function*Wt(e,t){let s=new ee(t);for(let n of e)yield s.encode(n)}async function*Jt(e,t){let s=new ee(t);for await(let n of e)yield s.encode(n)}function Yt(e,t={}){if(!e||typeof e!="object")throw new Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");let s=new Z(t),n,f=o=>{let u;n&&(o=__Buffer$.concat([n,o]),n=void 0);try{u=s.decodeMultiple(o)}catch(w){if(w.incomplete)n=o.slice(w.lastPosition),u=w.values;else throw w}return u};if(typeof e[Symbol.iterator]=="function")return function*(){for(let u of e)yield*f(u)}();if(typeof e[Symbol.asyncIterator]=="function")return async function*(){for await(let u of e)yield*f(u)}()}export{Pt as ALWAYS,jt as DECIMAL_FIT,Lt as DECIMAL_ROUND,Z as Decoder,ee as Encoder,we as FLOAT32_OPTIONS,Nt as NEVER,Ke as REUSE_BUFFER_MODE,J as Tag,Tt as addExtension,ge as clearSource,Ot as decode,Yt as decodeIter,kt as decodeMultiple,Ft as encode,Ct as encodeAsAsyncIterable,Vt as encodeAsIterable,zt as encodeIter,yt as isNativeAccelerationEnabled,Ut as roundFloat32};
//# sourceMappingURL=cbor-x.mjs.map